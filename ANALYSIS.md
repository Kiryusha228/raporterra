# Анализ функциональных требований к ПО

## Варианты использования системы отчетов

### 1. Регистрация

#### UC-01: Регистрация в системе
**Актор:** Администратор  
**Предусловие:** -  
**Основной поток:**
1. Администратор переходит на страницу регистрации
2. Система отображает форму с полями (почта, имя пользователя, пароль, подтверждение пароля)
3. Администратор вводит данные пользователя
4. Система проверяет:
   - Соответствие формата email корпоративной почте
   - Уникальность email в системе
   - Сложность пароля
5. Система создаёт учётную запись пользователя

**Альтернативный поток:**
1. Если проверка данных неудачная, система предлагает ввести другие данные

**Постусловие:** Пользователь становится участником системы

---

### 2. Аутентификация и авторизация

#### UC-02: Вход в систему
**Актор:** Пользователь, Администратор, Аналитик  
**Предусловие:** Пользователь зарегистрирован в системе  
**Основной поток:**
1. Пользователь вводит email и пароль (или авторизуется через OAuth-провайдера)
2. Система проверяет:
   - Корпоративный email (должен оканчиваться на @company.com)
   - Учётные данные пользователя
3. При успешной проверке система возвращает JWT-токен с ролями пользователя

**Альтернативный поток:**
1. При вводе некорректных данных система возвращает ошибку

**Постусловие:** Пользователь получает доступ согласно своей роли

#### UC-03: Выход из системы
**Актор:** Пользователь  
**Основной поток:**
1. Пользователь нажимает "Выход"
2. Система инвалидирует токен

---

### 3. Управление пользователями

#### UC-04: Назначение ролей
**Актор:** Администратор  
**Предусловие:** Пользователь существует в системе  
**Основной поток:**
1. Администратор выбирает пользователя из списка
2. Администратор назначает роль (USER, ANALYST, ADMIN)
3. Система сохраняет изменения в БД

#### UC-05: Просмотр списка пользователей
**Актор:** Администратор  
**Основной поток:**
1. Администратор открывает раздел пользователей
2. Система отображает таблицу пользователей
3. Система предоставляет администратору возможность фильтрации пользователей по ролям

---

### 4. Работа с отчётами

#### UC-06: Создание отчёта
**Актор:** Аналитик, Администратор  
**Основной поток:**
1. Пользователь заполняет форму:
   - Название отчёта
   - SQL-запрос (только SELECT)
   - Целевая БД (из списка подключений)
   - Параметры
2. Система валидирует SQL на read-only
3. Отчёт сохраняется с UUID

**Альтернативный поток:**
1. При ошибке в данных система оповещает и предлагает изменить:
   - Невалидный SQL-запрос
   - Ошибки в параметрах
   - Дублирование названия отчёта

#### UC-07: Выполнение отчёта
**Актор:** Пользователь  
**Основной поток:**
1. Пользователь выбирает отчёт из списка доступных
2. Вводит параметры (если есть)
3. Система ставит запрос в очередь (если БД занята)
4. Возвращает результат в виде таблицы или графика

**Альтернативный поток:**
1. При превышении 5 минут выполнения система отменяет запрос

#### UC-08: Выгрузка в Excel
**Актор:** Пользователь  
**Основной поток:**
1. После выполнения отчёта пользователь нажимает кнопку "Экспорт в Excel"
2. Система генерирует .xlsx файл

---

### 5. Управление коллекциями

#### UC-09: Создание коллекции
**Актор:** Аналитик, Администратор  
**Основной поток:**
1. Актор создает коллекцию (аналог папки)
2. Добавляет в нее отчёты из списка

#### UC-10: Назначение доступа к коллекции
**Актор:** Администратор  
**Основной поток:**
1. Администратор выбирает коллекцию
2. Назначает доступ:
   - Индивидуально пользователям
   - Группам пользователей

---

### 6. Запросы на создание отчетов

#### UC-11: Отправка запроса на создание отчёта
**Актор:** Пользователь  
**Основной поток:**
1. Пользователь заполняет форму:
   - Описание требуемого отчёта
2. Нажимает кнопку "Отправить запрос"
3. Запрос отправляется аналитикам/администраторам

**Альтернативный поток**
1. При пустом описании отчёта система не даёт отправить запрос и просит заполнить поле описания отчёта

#### UC-12: Обработка запроса на создание отчёта
**Актор:** Аналитик  
**Основной поток:**
1. Аналитик просматривает список запросов
2. Создает отчёт на основе запроса
3. Назначает доступ пользователю-инициатору

---

### 7. Администрирование системы

#### UC-13: Настройка очереди запросов
**Актор:** Администратор  
**Основной поток:**
1. Администратор задает:
   - Максимальное количество одновременных запросов на БД
   - Приоритеты для разных ролей
