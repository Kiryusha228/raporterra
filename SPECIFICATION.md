# Спецификация требований к системе

## 1. Общие положения

### Цель
Разработка веб-сервиса для выполнения параметризованных SQL-отчетов с разграничением доступа и управлением очередью запросов

### Описание проекта
Разрабатывается веб-сервис с разграничением функциональности в зависимости от типа пользователя: пользователь, администратор (и nice to have: аналитик). Уровни доступа и роли хранятся в базе данных сервиса.

### Стек технологий
База данных сервиса: PostgreSQL
Бэкенд: Java/Kotlin, Spring 3+, Gradle
Фронтенд: Angular, Taiga UI

## 2. Функциональные требования

### Сервис авторизации/аутентификации

Каждому пользователю присваивается уникальный числовой идентификатор (ID). Роли пользователей определяются и управляются через базу данных.

1) Ограничение по домену:
    - Разрешены только email с доменами @company.com
    - При попытке регистрации с некорпоративным email возвращается ошибка 403 Forbidden с сообщением: "Доступ разрешен только для корпоративных email"

2) Ролевая модель:
    - USER: выполнение отчетов
    - ANALYST: создание отчетов + функциональность USER
    - ADMIN: управление пользователями + полный доступ

3) OAuth2-провайдеры: Яндекс

4) Требования к UI:
    • Форма входа:
    - Поля: Email, Password
    - Кнопки: "Войти", "Войти через Яндекс"
    • Форма регистрации:
    - Поля: Email, Username, Password
    - Кнопки: "Зарегистрироваться"
    - Валидация в реальном времени - Подсветка некорпоративного email

### Сервис работы с отчётами

Отчет представляет собой SQL-запрос, привязанный к конкретной базе данных.
У каждого отчета — уникальный UUID. Сервис поддерживает подключение к произвольным базам данных с любыми структурами таблиц

1) Создание отчёта
• Поля формы:
| Поле           | Тип    | Обязательное | Валидация                  |
|----------------|--------|--------------|----------------------------|
| name           | String | Да	         | Уникальное                 |
| description    | String | Нет          | До 5000 символов           |
| sql_query      | String |	Да           | Только SELECT              |
| connection_id  | Long   | Да           | Существующий connection_id |
Также присутствуют кнопки "Создать отчёт", "Отменить"
• Ограничения:
    - Максимальная длина SQL-запроса: 10 000 символов
    - Запрещённые ключевые слова: INSERT, UPDATE, DELETE, DROP, GRANT
    - Автоматическая проверка синтаксиса 

2) Выполнение отчёта
• Очередь запросов:
    - Приоритеты: ADMIN (высокий), ANALYST (средний), USER (низкий)
    - Максимум 1 активный запрос на базу данных
• Ограничения выполнения:
    - Таймаут: 5 минут
• Форма выполнения отчёта
Шапка отчёта
| Элемент         | Описание                                                                  |
|-----------------|---------------------------------------------------------------------------|
| Название отчёта | Отображается данное отчёту при создании название                          |
| Описание        | Текстовая сводка под названием (макс. 3 строки, с возможностью раскрытия) |
| Иконка статуса  |	◷ (в очереди), ▶ (выполняется), ✓ (готово), ✗ (ошибка)                  |
| Информация о БД | Имя подключения + иконка типа БД (PostgreSQL/MySQL/Oracle)                |

Кнопки действий
| Кнопка            | Поведение                                                                             |
|-------------------|---------------------------------------------------------------------------------------|
| "Выполнить"       | Отправка запроса, переход в статус "В очереди"                                        |
| "Экспорт в Excel" | Запуск процесса создания XLSX-файла с именем <Название отчёта>_<Дата выполнения>.xlsx |

Состояние успешного завершения
    - Таблица данных:
        Сортировка по столбцам
        Поиск по столбцам

### Разграничение функциональности

• Функциональность администратора

    - Назначение ролей доступа пользователям
    - Создание новых SQL-отчетов
    - Назначение отчетов конкретным пользователям

• Функциональность пользователя

    - Просмотр списка доступных ему отчетов
    - Просмотр отчета в веб-интерфейсе
    - Выгрузка отчета в формате Excel

